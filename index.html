<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Solar Tetris</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            background: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            overflow: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .header {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        h1 {
            color: #ffd700;
            margin-bottom: 5px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #40e0d0;
        }

        .stat-label {
            font-size: 12px;
            color: #87ceeb;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        canvas {
            background: #000;
            border: 3px solid #333;
            border-radius: 5px;
            display: block;
        }

        .controls {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .btn {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 20px;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            min-width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
        }

        .btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        .action-btn {
            background: linear-gradient(to right, #27ae60, #2ecc71);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        #pauseBtn {
            background: linear-gradient(to right, #e67e22, #f39c12);
        }

        .notification {
            position: fixed;
            top: 20px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üéÆ –¢–ï–¢–†–ò–°</h1>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="score">0</div>
                    <div class="stat-label">–û–ß–ö–ò</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">–£–†–û–í–ï–ù–¨</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="lines">0</div>
                    <div class="stat-label">–õ–ò–ù–ò–ò</div>
                </div>
            </div>
        </div>

        <div class="game-area">
            <canvas id="tetris" width="300" height="600"></canvas>
            
            <div class="controls">
                <div class="control-row">
                    <button class="btn" id="left">‚Üê</button>
                    <button class="btn" id="rotate">‚Üª</button>
                    <button class="btn" id="right">‚Üí</button>
                </div>
                <div class="control-row">
                    <button class="btn" id="down">‚Üì</button>
                    <button class="btn" id="drop">üí•</button>
                </div>
                <div class="control-row">
                    <button class="action-btn" id="startBtn">
                        <span>‚ñ∂Ô∏è</span>
                        <span>–°–¢–ê–†–¢</span>
                    </button>
                    <button class="action-btn" id="pauseBtn">
                        <span>‚è∏Ô∏è</span>
                        <span>–ü–ê–£–ó–ê</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
        const canvas = document.getElementById('tetris');
        const ctx = canvas.getContext('2d');
        
        // –†–∞–∑–º–µ—Ä—ã –ø–æ–ª—è
        const COLS = 10;
        const ROWS = 20;
        const BLOCK_SIZE = 30;
        
        canvas.width = COLS * BLOCK_SIZE;
        canvas.height = ROWS * BLOCK_SIZE;
        
        // –¶–≤–µ—Ç–∞ —Ñ–∏–≥—É—Ä
        const COLORS = [
            '#000000', // –ü—É—Å—Ç–æ
            '#FF0000', // I
            '#00FF00', // J
            '#0000FF', // L
            '#FFFF00', // O
            '#FF00FF', // S
            '#00FFFF', // T
            '#FF8800'  // Z
        ];
        
        // –§–∏–≥—É—Ä—ã –¢–µ—Ç—Ä–∏—Å–∞
        const SHAPES = [
            null,
            [ // I
                [0,0,0,0],
                [1,1,1,1],
                [0,0,0,0],
                [0,0,0,0]
            ],
            [ // J
                [2,0,0],
                [2,2,2],
                [0,0,0]
            ],
            [ // L
                [0,0,3],
                [3,3,3],
                [0,0,0]
            ],
            [ // O
                [4,4],
                [4,4]
            ],
            [ // S
                [0,5,5],
                [5,5,0],
                [0,0,0]
            ],
            [ // T
                [0,6,0],
                [6,6,6],
                [0,0,0]
            ],
            [ // Z
                [7,7,0],
                [0,7,7],
                [0,0,0]
            ]
        ];
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let board = createBoard();
        let score = 0;
        let level = 1;
        let lines = 0;
        let gameOver = false;
        let paused = false;
        let dropCounter = 0;
        let dropInterval = 1000;
        let lastTime = 0;
        
        let player = {
            pos: {x: 0, y: 0},
            matrix: null
        };
        
        // ============ –§–£–ù–ö–¶–ò–ò ============
        function createBoard() {
            return Array.from({length: ROWS}, () => Array(COLS).fill(0));
        }
        
        function createPiece() {
            const pieces = 'IJLOSTZ';
            const rand = pieces[Math.floor(Math.random() * pieces.length)];
            let matrix;
            
            switch(rand) {
                case 'I': matrix = SHAPES[1]; break;
                case 'J': matrix = SHAPES[2]; break;
                case 'L': matrix = SHAPES[3]; break;
                case 'O': matrix = SHAPES[4]; break;
                case 'S': matrix = SHAPES[5]; break;
                case 'T': matrix = SHAPES[6]; break;
                case 'Z': matrix = SHAPES[7]; break;
            }
            
            player.matrix = matrix;
            player.pos.y = 0;
            player.pos.x = Math.floor(COLS / 2) - Math.floor(matrix[0].length / 2);
            
            if (collide()) {
                gameOver = true;
            }
        }
        
        function collide() {
            const [m, o] = [player.matrix, player.pos];
            
            for (let y = 0; y < m.length; y++) {
                for (let x = 0; x < m[y].length; x++) {
                    if (m[y][x] !== 0 &&
                        (board[y + o.y] && board[y + o.y][x + o.x]) !== 0) {
                        return true;
                    }
                }
            }
            return false;
        }
        
        function merge() {
            player.matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        const boardY = y + player.pos.y;
                        const boardX = x + player.pos.x;
                        if (boardY >= 0 && boardY < ROWS && boardX >= 0 && boardX < COLS) {
                            board[boardY][boardX] = value;
                        }
                    }
                });
            });
        }
        
        function playerDrop() {
            player.pos.y++;
            if (collide()) {
                player.pos.y--;
                merge();
                createPiece();
                sweep();
            }
            dropCounter = 0;
        }
        
        function playerMove(dir) {
            player.pos.x += dir;
            if (collide()) {
                player.pos.x -= dir;
            }
        }
        
        function playerRotate() {
            const pos = player.pos.x;
            let offset = 1;
            rotate(player.matrix);
            
            while (collide()) {
                player.pos.x += offset;
                offset = -(offset + (offset > 0 ? 1 : -1));
                if (offset > player.matrix[0].length) {
                    rotate(player.matrix);
                    rotate(player.matrix);
                    rotate(player.matrix);
                    player.pos.x = pos;
                    return;
                }
            }
        }
        
        function rotate(matrix) {
            const N = matrix.length;
            for (let y = 0; y < N; y++) {
                for (let x = 0; x < y; x++) {
                    [matrix[x][y], matrix[y][x]] = [matrix[y][x], matrix[x][y]];
                }
            }
            matrix.forEach(row => row.reverse());
        }
        
        function sweep() {
            let rowCount = 0;
            
            outer: for (let y = ROWS - 1; y >= 0; y--) {
                for (let x = 0; x < COLS; x++) {
                    if (board[y][x] === 0) {
                        continue outer;
                    }
                }
                
                const row = board.splice(y, 1)[0].fill(0);
                board.unshift(row);
                rowCount++;
                y++;
            }
            
            if (rowCount > 0) {
                score += rowCount * 100 * level;
                lines += rowCount;
                level = Math.floor(lines / 10) + 1;
                dropInterval = 1000 - (level - 1) * 100;
                
                document.getElementById('score').textContent = score;
                document.getElementById('lines').textContent = lines;
                document.getElementById('level').textContent = level;
                
                showNotification(`+${rowCount} –ª–∏–Ω–∏—è!`);
            }
        }
        
        function draw() {
            // –û—á–∏—â–∞–µ–º –∫–∞–Ω–≤–∞—Å
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –ø–æ–ª–µ
            drawMatrix(board, {x: 0, y: 0});
            
            // –†–∏—Å—É–µ–º —Ç–µ–∫—É—â—É—é —Ñ–∏–≥—É—Ä—É
            if (player.matrix) {
                drawMatrix(player.matrix, player.pos);
            }
            
            // –ï—Å–ª–∏ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞
            if (gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = 'red';
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê', canvas.width / 2, canvas.height / 2);
                ctx.font = '16px Arial';
                ctx.fillText('–ù–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢', canvas.width / 2, canvas.height / 2 + 30);
            }
        }
        
        function drawMatrix(matrix, offset) {
            matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        ctx.fillStyle = COLORS[value];
                        ctx.fillRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE,
                            BLOCK_SIZE - 1,
                            BLOCK_SIZE - 1
                        );
                        
                        // –ì—Ä–∞–Ω–∏—Ü—ã –±–ª–æ–∫–æ–≤
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE,
                            BLOCK_SIZE - 1,
                            BLOCK_SIZE - 1
                        );
                    }
                });
            });
        }
        
        function showNotification(msg) {
            const note = document.getElementById('notification');
            note.textContent = msg;
            note.style.display = 'block';
            setTimeout(() => {
                note.style.display = 'none';
            }, 1500);
        }
        
        function update(time = 0) {
            const deltaTime = time - lastTime;
            lastTime = time;
            
            if (!paused && !gameOver) {
                dropCounter += deltaTime;
                if (dropCounter > dropInterval) {
                    playerDrop();
                }
            }
            
            draw();
            requestAnimationFrame(update);
        }
        
        // ============ –£–ü–†–ê–í–õ–ï–ù–ò–ï ============
        // –ö–Ω–æ–ø–∫–∏
        document.getElementById('left').addEventListener('click', () => {
            if (!paused && !gameOver) playerMove(-1);
        });
        
        document.getElementById('right').addEventListener('click', () => {
            if (!paused && !gameOver) playerMove(1);
        });
        
        document.getElementById('down').addEventListener('click', () => {
            if (!paused && !gameOver) playerDrop();
        });
        
        document.getElementById('rotate').addEventListener('click', () => {
            if (!paused && !gameOver) playerRotate();
        });
        
        document.getElementById('drop').addEventListener('click', () => {
            if (!paused && !gameOver) {
                while (!collide()) {
                    player.pos.y++;
                }
                player.pos.y--;
                merge();
                createPiece();
                sweep();
            }
        });
        
        // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        document.getElementById('startBtn').addEventListener('click', () => {
            if (gameOver) {
                board = createBoard();
                score = 0;
                level = 1;
                lines = 0;
                gameOver = false;
                paused = false;
                
                document.getElementById('score').textContent = '0';
                document.getElementById('level').textContent = '1';
                document.getElementById('lines').textContent = '0';
                document.getElementById('pauseBtn').innerHTML = '<span>‚è∏Ô∏è</span><span>–ü–ê–£–ó–ê</span>';
            }
            
            createPiece();
            update();
            showNotification('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!');
        });
        
        // –ü–∞—É–∑–∞
        document.getElementById('pauseBtn').addEventListener('click', () => {
            if (gameOver) return;
            
            paused = !paused;
            document.getElementById('pauseBtn').innerHTML = paused 
                ? '<span>‚ñ∂Ô∏è</span><span>–ü–†–û–î–û–õ–ñ–ò–¢–¨</span>'
                : '<span>‚è∏Ô∏è</span><span>–ü–ê–£–ó–ê</span>';
        });
        
        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        document.addEventListener('keydown', event => {
            if (paused || gameOver) return;
            
            switch(event.key) {
                case 'ArrowLeft':
                case 'a':
                    event.preventDefault();
                    playerMove(-1);
                    break;
                case 'ArrowRight':
                case 'd':
                    event.preventDefault();
                    playerMove(1);
                    break;
                case 'ArrowDown':
                case 's':
                    event.preventDefault();
                    playerDrop();
                    break;
                case 'ArrowUp':
                case 'w':
                    event.preventDefault();
                    playerRotate();
                    break;
                case ' ':
                    event.preventDefault();
                    while (!collide()) {
                        player.pos.y++;
                    }
                    player.pos.y--;
                    merge();
                    createPiece();
                    sweep();
                    break;
                case 'p':
                    event.preventDefault();
                    paused = !paused;
                    document.getElementById('pauseBtn').innerHTML = paused 
                        ? '<span>‚ñ∂Ô∏è</span><span>–ü–†–û–î–û–õ–ñ–ò–¢–¨</span>'
                        : '<span>‚è∏Ô∏è</span><span>–ü–ê–£–ó–ê</span>';
                    break;
            }
        });
        
        // ============ –ó–ê–ü–£–°–ö ============
        // –ù–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
        draw();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
        setTimeout(() => {
            showNotification('–ù–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!');
        }, 500);
    </script>
</body>
</html>
